import{r as l,j as e,P as r}from"./index-BOhTwHsC.js";import{a as k,e as m}from"./endpoints-CS5nTNlK.js";import{a as g,c as D}from"./index.esm-DVdv_w6Z.js";import{T as M}from"./TablaCoreUI-C0N1yp5E.js";import{M as O}from"./ModalConfirmaciónEliminación-CftZkWG8.js";import{h as R}from"./categoryUtils-C_UIeg_C.js";import{C as U,a as w,b as F,c as $}from"./CModalHeader-Cywm-KxM.js";import{C as q}from"./CModalTitle-C9QoWCw2.js";import{C as B}from"./CForm-BA2yB9WS.js";import{C as A,a as y}from"./CRow-DiePAMTK.js";import{C as v}from"./CFormInput-BKq-2Q75.js";import{C as z}from"./CFormSelect-BQDtEt72.js";import{C as G}from"./CAlert-DQxL4qKi.js";import{C as H,a as K}from"./CCardBody-MXlmbL9P.js";import{C as W}from"./CCardHeader-DMR-Y4ve.js";import{I as J}from"./DefaultLayout-D6kBYcTj.js";import{c as Q,a as V}from"./cil-trash-prAk5aip.js";import"./react-paginate-CnSu5TAu.js";import"./CTable-DrtmPXdZ.js";import"./cil-chevron-right-DSvcss7_.js";import"./CFormControlWrapper-C92rYEwl.js";import"./CFormControlValidation-Ck9L-Gmv.js";import"./CFormLabel-CpYCFpvI.js";import"./cil-user-Dlmw-Gem.js";import"./softys-8HeVkQ7R.js";const L={id:"",title:"",link:"",link_type:"link",image:null},N=({visible:o,onClose:a,onSave:b,item:i,isNew:p})=>{const[u,f]=l.useState(L),[c,s]=l.useState(!1),d=x=>{const{name:P,value:E,files:C}=x.target;f({...u,[P]:C?C[0]:E})},h=async()=>{s(!0);try{await R(u,b,"image")}catch(x){console.error("Error al enviar el formulario:",x)}finally{s(!1)}};return l.useEffect(()=>{o&&(p?f(L):i&&f({id:i.id||"",title:i.title||"",link:i.link||"",link_type:i.link_type||"link",image:i.image||null}))},[o,i,p]),e.jsxs(U,{visible:o,onClose:a,size:"lg",alignment:"center",scrollable:!0,children:[e.jsx(w,{children:e.jsx(q,{children:p?"Nuevo":"Editar"})}),e.jsx(F,{children:e.jsx(B,{children:e.jsxs(A,{children:[e.jsx(y,{md:6,children:e.jsx(v,{type:"text",label:"Título",name:"title",value:u.title,onChange:d,required:!0})}),e.jsx(y,{md:6,children:e.jsxs(z,{"aria-label":"Tipo de Link",name:"link_type",label:"Tipo de Link",value:u.link_type,onChange:d,required:!0,children:[e.jsx("option",{value:"link",children:"General"}),e.jsx("option",{value:"pdf",children:"PDF"})]})}),e.jsx(y,{md:12,children:e.jsx(v,{type:"text",label:"Link",name:"link",value:u.link,onChange:d,required:!0})}),e.jsx(y,{md:6,children:e.jsx(v,{type:"file",label:"Imagen",name:"image",onChange:d})})]})})}),e.jsxs($,{children:[e.jsx(g,{color:"secondary",onClick:a,children:"Cancelar"}),e.jsx(g,{color:"primary",onClick:h,disabled:c,children:c?p?"Guardando...":"Actualizando...":p?"Guardar":"Actualizar"})]})]})};N.propTypes={visible:r.bool.isRequired,onClose:r.func.isRequired,onSave:r.func.isRequired,item:r.shape({id:r.oneOfType([r.number,r.string]),title:r.string,link:r.string,link_type:r.string,image:r.oneOfType([r.string,r.object])}).isRequired,isNew:r.bool};const be=()=>{const[o,a]=l.useState(null),[b,i]=l.useState([]),[p,u]=l.useState(!0),[f,c]=l.useState(null),[s,d]=l.useState({visible:!1,type:null,item:null}),h=`${m.API_BASE_URL}${m.ENDPOINTS.POPUP.GET}`,x=l.useCallback(async()=>{try{const t=await k.get(h);t.data.success?i(t.data.data):c(t.data.message)}catch{c("Error al obtener los registros")}finally{u(!1)}},[h]);l.useEffect(()=>{x()},[]);const P=[{key:"id",label:"ID"},{key:"title",label:"Título"},{key:"image",label:"Imagen",render:t=>e.jsx(J,{rounded:!0,src:t.image,style:{maxWidth:"100px"},className:"img-fluid"})},{key:"link",label:"Link",render:t=>e.jsx("a",{href:t.link,target:"_blank",rel:"noreferrer",children:"Ir al link"})},{key:"link_type",label:"Tipo Link",render:t=>t.link_type==="pdf"?"PDF":t.link_type==="link"?"General":t.link_type},{key:"acciones",label:"Opciones",render:t=>e.jsxs(e.Fragment,{children:[e.jsx(g,{color:"warning",size:"sm",className:"me-2",onClick:()=>S("edit",t),children:e.jsx(D,{icon:Q})}),e.jsx(g,{color:"danger",size:"sm",onClick:()=>S("delete",t),children:e.jsx(D,{icon:V})})]})}],E=async t=>{try{const n=!t.id,T=n?`${m.API_BASE_URL}${m.ENDPOINTS.POPUP.CREATE}`:`${m.API_BASE_URL}${m.ENDPOINTS.POPUP.UPDATE(t.id)}`,j=await(n?k.post:k.put)(T,t);j.data.success?(x(),a({text:j.data.message,type:"success"})):(c(j.data.message),a({text:j.data.message,type:"error"}))}catch{c("Error al guardar el registro"),a({text:"Error al guardar el registro",type:"error"})}finally{d({visible:!1,type:null,item:null})}},C=async()=>{if(s.item)try{const t=`${m.API_BASE_URL}${m.ENDPOINTS.POPUP.DELETE(s.item.id)}`,n=await k.delete(t);n.data.success?(i(T=>T.filter(I=>I.id!==s.item.id)),a({text:n.data.message,type:"success"})):(c(n.data.message),a({text:n.data.message,type:"error"}))}catch{c("Error al eliminar el registro"),a({text:"Error al eliminar el registro",type:"error"})}finally{d({visible:!1,type:null,item:null})}},S=(t,n=null)=>{d({visible:!0,type:t,item:n})},_=()=>{d({visible:!1,type:null,item:null})};return l.useEffect(()=>{if(o){const t=setTimeout(()=>a(null),5e3);return()=>clearTimeout(t)}},[o]),p?e.jsx("p",{children:"Cargando..."}):f?e.jsxs("p",{children:["Error: ",f]}):e.jsxs(e.Fragment,{children:[o&&e.jsx(G,{color:o.type==="success"?"success":"danger",dismissible:!0,onClose:()=>a(null),children:o.text}),e.jsx(A,{children:e.jsx(y,{xs:12,children:e.jsxs(H,{className:"mb-4",children:[e.jsxs(W,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Popups"})," ",e.jsx("small",{children:"Listar"})]}),e.jsx(g,{color:"primary",size:"sm",onClick:()=>S("new",{}),children:"Nuevo"})]}),e.jsx(K,{children:e.jsx(M,{itemsPerPage:10,columns:P,data:b,searchKeys:["title","category.title"],defaultSortKey:"id"})})]})})}),["edit","new"].includes(s.type)&&e.jsx(N,{visible:s.visible,onClose:_,onSave:E,item:s.item,isNew:s.type==="new"}),s.type==="delete"&&e.jsx(O,{visible:s.visible,onClose:_,onConfirm:C})]})};export{be as default};
