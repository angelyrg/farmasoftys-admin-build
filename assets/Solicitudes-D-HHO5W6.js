import{j as e,r}from"./index-BOhTwHsC.js";import{a as _,e as n}from"./endpoints-CS5nTNlK.js";import{a as R,c as O}from"./index.esm-DVdv_w6Z.js";import{T}from"./TablaCoreUI-C0N1yp5E.js";import{C as b,a as N,b as M,c as I}from"./CModalHeader-Cywm-KxM.js";import{C as B}from"./CAlert-DQxL4qKi.js";import{C as k,a as U}from"./CRow-DiePAMTK.js";import{C as w,a as z}from"./CCardBody-MXlmbL9P.js";import{C as v}from"./CCardHeader-DMR-Y4ve.js";import{c as G,a as H}from"./cil-x-B8NR0tyJ.js";import{l as Z}from"./DefaultLayout-D6kBYcTj.js";import"./react-paginate-CnSu5TAu.js";import"./CFormInput-BKq-2Q75.js";import"./CFormControlWrapper-C92rYEwl.js";import"./CFormControlValidation-Ck9L-Gmv.js";import"./CFormLabel-CpYCFpvI.js";import"./CTable-DrtmPXdZ.js";import"./cil-chevron-right-DSvcss7_.js";import"./cil-user-Dlmw-Gem.js";import"./softys-8HeVkQ7R.js";const L=({visible:o,type:t,onClose:d,onConfirm:E,item:C})=>{const l=t==="accept",A=l?"Confirmar Aceptar":"Confirmar Rechazar",u=l?"¿Estás seguro de que deseas aceptar esta solicitud?":"¿Estás seguro de que deseas rechazar esta solicitud?",i=l?"Aceptar":"Rechazar",c=l?"success":"danger";return e.jsxs(b,{visible:o,onClose:d,children:[e.jsx(N,{children:A}),e.jsx(M,{children:u}),e.jsxs(I,{children:[e.jsx(R,{color:"secondary",onClick:d,children:"Cancel"}),e.jsx(R,{color:c,onClick:()=>E(C),children:i})]})]})},a={CREADA:1,RECHAZADA_POR_MANAGER:2,APROBADA_POR_MANAGER:3,RECHAZADA_POR_ADMIN:4,APROBADA_POR_ADMIN:5},$={[a.CREADA]:"primary",[a.RECHAZADA_POR_MANAGER]:"warning",[a.APROBADA_POR_MANAGER]:"info",[a.RECHAZADA_POR_ADMIN]:"danger",[a.APROBADA_POR_ADMIN]:"success"},D={[a.CREADA]:"Aprobación pendiente por parte del representante de la farmacia",[a.RECHAZADA_POR_MANAGER]:"Cancelada por el representante de la farmacia",[a.APROBADA_POR_MANAGER]:"Aprobada por el representante de la farmacia",[a.RECHAZADA_POR_ADMIN]:"Rechazada por el administrador",[a.APROBADA_POR_ADMIN]:"Aprobada por el administrador"},Ae=()=>{const[o,t]=r.useState(null),[d,E]=r.useState([]),[C,l]=r.useState(!0),[A,u]=r.useState(null),[i,c]=r.useState({visible:!1,type:null,item:null}),x=`${n.API_BASE_URL}${n.ENDPOINTS.STORE_REQUESTS.GET}`,f=s=>e.jsx(Z,{color:$[s.status],children:s.status_label}),h=r.useCallback(async()=>{try{const s=await _.get(x);s.data.success?E(s.data.data):u(s.data.message)}catch{u("Error al obtener los datos")}finally{l(!1)}},[x]);r.useEffect(()=>{h()},[]);const j=async s=>{const m=i.type==="accept",P=m?a.APROBADA_POR_ADMIN:a.RECHAZADA_POR_ADMIN;try{if(m){const g=await _.post(`${n.API_BASE_URL}${n.ENDPOINTS.STORES.CREATE}`,{name:s.name,ruc:s.ruc,address:s.address,phone:s.phone,registro_solicitud_id:s.id,latitude:"",longitude:"",max_radius:"",tienda_img:"https://res.cloudinary.com/dlnx6im7h/image/upload/v1719813012/softys/products/qrs7t6xjsd1egxpw5zg3.webp"});if(!g.data.success){t({type:"error",text:g.data.message||"Error al registrar la tienda."});return}}const p=await _.put(`${n.API_BASE_URL}${n.ENDPOINTS.STORE_REQUESTS.UPDATE(s.id)}`,{status:P});if(!p.data.success){t({type:"error",text:p.data.message||"Error al actualizar el estado de la solicitud."});return}t({type:"success",text:"Estado actualizado correctamente."}),h()}catch(p){t({type:"error",text:"Ocurrió un error al procesar la solicitud."}),console.error(p)}finally{c({visible:!1,type:null,item:null})}},y=[{key:"id",label:"ID"},{key:"ruc",label:"RUC"},{key:"name",label:"Nombre",render:s=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[s.name," "]}),s.status===a.APROBADA_POR_MANAGER&&e.jsx("small",{title:D[s.status],children:f(s)})]})},{key:"manager_name",label:"Representante"},{key:"address",label:"Dirección"},{key:"phone",label:"Celular"},{key:"email",label:"Email"},{key:"status",label:"Estado",render:s=>s.status===a.APROBADA_POR_MANAGER?e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(R,{color:"success",size:"sm",onClick:()=>S("accept",s),title:"Aprobar la solicitud",children:e.jsx(O,{icon:G,className:"text-white"})}),e.jsx(R,{color:"danger",size:"sm",onClick:()=>S("reject",s),title:"Rechazar la solicitud",children:e.jsx(O,{icon:H,className:"text-white"})})]}):e.jsx("small",{title:D[s.status],children:f(s)})}],S=(s,m=null)=>{c({visible:!0,type:s,item:m})};return r.useEffect(()=>{if(o){const s=setTimeout(()=>t(null),5e3);return()=>clearTimeout(s)}},[o]),C?e.jsx("p",{children:"Cargando..."}):A?e.jsxs("p",{children:["Error: ",A]}):e.jsxs(e.Fragment,{children:[o&&e.jsx(B,{color:o.type==="success"?"success":"danger",dismissible:!0,onClose:()=>t(null),children:o.text}),e.jsx(k,{children:e.jsx(U,{xs:12,children:e.jsxs(w,{className:"mb-4",children:[e.jsx(v,{className:"d-flex justify-content-between align-items-center",children:e.jsx("div",{children:e.jsx("strong",{children:"Solicitud de registro de Tienda"})})}),e.jsx(z,{children:e.jsx(T,{itemsPerPage:15,columns:y,data:d,searchKeys:["ruc","name","manager_name","address","phone","email"],defaultSortKey:"id"})})]})})}),e.jsx(L,{visible:i.visible,type:i.type,onClose:()=>c({visible:!1,type:null,item:null}),onConfirm:j,item:i.item})]})};export{Ae as default};
