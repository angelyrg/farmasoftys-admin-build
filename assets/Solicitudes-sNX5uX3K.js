import{j as e,r as a}from"./index-BSGErEM6.js";import{a as j,e as n}from"./endpoints-FQ_58ef9.js";import{a as h,c as R}from"./index.esm-DHIEEdvX.js";import{T as w}from"./TablaCoreUI-BSiPMSrq.js";import{C as N,a as _,b as v,c as z}from"./CModalHeader-C2bE6kmo.js";import{C as D}from"./CAlert-DQ7iv2zy.js";import{C as I,a as P}from"./CRow-DmcC_b5O.js";import{C as M,a as U}from"./CCardBody-BoIb-BeF.js";import{C as B}from"./CCardHeader-BjtyZ_kD.js";import{c as O,a as $}from"./cil-x-B8NR0tyJ.js";import{l as i}from"./DefaultLayout-ClxKSXA3.js";import"./react-paginate-Ytz0_Y3V.js";import"./CFormInput-DjsZBaJT.js";import"./CFormControlWrapper-BV3MrKMS.js";import"./CFormControlValidation-DsORKtit.js";import"./CFormLabel-CnIyLzqE.js";import"./CTable-CrBhvolg.js";import"./cil-chevron-right-DSvcss7_.js";import"./cil-user-Dlmw-Gem.js";import"./softys-8HeVkQ7R.js";const q=({visible:r,type:t,onClose:d,onConfirm:f,item:C})=>{const o=t==="accept",u=o?"Confirmar Aceptar":"Confirmar Rechazar",m=o?"¿Estás seguro de que deseas aceptar esta solicitud?":"¿Estás seguro de que deseas rechazar esta solicitud?",c=o?"Aceptar":"Rechazar",l=o?"success":"warning";return e.jsxs(N,{visible:r,onClose:d,children:[e.jsx(_,{children:u}),e.jsx(v,{children:m}),e.jsxs(z,{children:[e.jsx(h,{color:"secondary",onClick:d,children:"Cancel"}),e.jsx(h,{color:l,onClick:()=>f(C),children:c})]})]})},le=()=>{const[r,t]=a.useState(null),[d,f]=a.useState([]),[C,o]=a.useState(!0),[u,m]=a.useState(null),[c,l]=a.useState({visible:!1,type:null,item:null}),g=`${n.API_BASE_URL}${n.ENDPOINTS.STORE_REQUESTS.GET}`,y=s=>{switch(s.status){case 0:return e.jsx(i,{color:"danger",children:"Eliminado"});case 1:return e.jsx(i,{color:"info",children:"Nuevo"});case 2:return e.jsx(i,{color:"success",children:"Aceptado"});case 3:return e.jsx(i,{color:"warning",children:"Rechazado"});default:return e.jsx(i,{color:"secondary",children:"Desconocido"})}},E=a.useCallback(async()=>{try{const s=await j.get(g);s.data.success?f(s.data.data):m(s.data.message)}catch{m("Error al obtener los datos")}finally{o(!1)}},[g]);a.useEffect(()=>{E()},[]);const A=async s=>{const p=c.type==="accept",k=p?2:3;try{if(p){const b=await j.post(`${n.API_BASE_URL}${n.ENDPOINTS.STORES.CREATE}`,{name:s.name,ruc:s.ruc,address:s.address,phone:s.phone,latitude:"",longitude:"",max_radius:"",tienda_img:"https://res.cloudinary.com/dlnx6im7h/image/upload/v1719813012/softys/products/qrs7t6xjsd1egxpw5zg3.webp"});if(!b.data.success){t({type:"error",text:b.data.message||"Error al registrar la tienda."});return}}const x=await j.put(`${n.API_BASE_URL}${n.ENDPOINTS.STORE_REQUESTS.UPDATE(s.id)}`,{status:k});if(!x.data.success){t({type:"error",text:x.data.message||"Error al actualizar el estado de la solicitud."});return}t({type:"success",text:"Estado actualizado correctamente."}),E()}catch(x){t({type:"error",text:"Ocurrió un error al procesar la solicitud."}),console.error(x)}finally{l({visible:!1,type:null,item:null})}},T=[{key:"id",label:"ID"},{key:"ruc",label:"RUC"},{key:"name",label:"Nombre",render:s=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[s.name," "]}),s.status===1&&y(s)]})},{key:"manager_name",label:"Representante"},{key:"address",label:"Dirección"},{key:"phone",label:"Celular"},{key:"email",label:"Email"},{key:"status",label:"Estado",render:s=>s.status===1?e.jsxs(e.Fragment,{children:[e.jsx(h,{color:"success",size:"sm",className:"me-2",onClick:()=>S("accept",s),title:"Accept Request",children:e.jsx(R,{icon:O,className:"text-white"})}),e.jsx(h,{color:"warning",size:"sm",onClick:()=>S("reject",s),title:"Reject Request",children:e.jsx(R,{icon:$,className:"text-white"})})]}):y(s)}],S=(s,p=null)=>{l({visible:!0,type:s,item:p})};return a.useEffect(()=>{if(r){const s=setTimeout(()=>t(null),5e3);return()=>clearTimeout(s)}},[r]),C?e.jsx("p",{children:"Cargando..."}):u?e.jsxs("p",{children:["Error: ",u]}):e.jsxs(e.Fragment,{children:[r&&e.jsx(D,{color:r.type==="success"?"success":"danger",dismissible:!0,onClose:()=>t(null),children:r.text}),e.jsx(I,{children:e.jsx(P,{xs:12,children:e.jsxs(M,{className:"mb-4",children:[e.jsx(B,{className:"d-flex justify-content-between align-items-center",children:e.jsx("div",{children:e.jsx("strong",{children:"Solicitud de registro de Tienda"})})}),e.jsx(U,{children:e.jsx(w,{itemsPerPage:10,columns:T,data:d,searchKeys:["narucme","name","manager_name","address","phone","email"],defaultSortKey:"id"})})]})})}),e.jsx(q,{visible:c.visible,type:c.type,onClose:()=>l({visible:!1,type:null,item:null}),onConfirm:A,item:c.item})]})};export{le as default};
