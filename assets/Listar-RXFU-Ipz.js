import{r as a,j as e,P as r}from"./index-BbdSqWC9.js";import{a as f,e as d}from"./endpoints-BX9h9ZCO.js";import{a as h,c as I}from"./index.esm-DCg1vWKa.js";import{T as F}from"./TablaCoreUI-BNpmaOWE.js";import{M as U}from"./ModalConfirmaciónEliminación-CmWqohBo.js";import{h as G}from"./categoryUtils-ReMHyvb-.js";import{C as V,a as z,b as H,c as K}from"./CModalHeader-C_EbAsF2.js";import{C as W}from"./CModalTitle-7K0FyB5J.js";import{C as Y}from"./CForm-BsUL6XdD.js";import{C as O,a as y}from"./CRow-DX7WfHcK.js";import{C as T}from"./CFormInput-DDUSGyiz.js";import{C as P}from"./CFormSelect-I6xFNqIv.js";import{C as J}from"./CAlert-DnvX20Lt.js";import{C as Q,a as X}from"./CCardBody-B-X9cGRP.js";import{C as Z}from"./CCardHeader-DLbDbJrL.js";import{I as ee}from"./DefaultLayout-BuKkoChH.js";import{c as te,a as re}from"./cil-trash-prAk5aip.js";import"./react-paginate-DCkc9IEO.js";import"./CTable-xzfvi4v6.js";import"./cil-chevron-right-DSvcss7_.js";import"./CFormControlWrapper-CSgDey9a.js";import"./CFormControlValidation-La-DNwq6.js";import"./CFormLabel-Bi_OkBaw.js";import"./cil-user-Dlmw-Gem.js";import"./softys-8HeVkQ7R.js";const w={id:"",news_category_id:"",title:"",link:"",link_type:"link",image:null},L=({visible:m,onClose:i,onSave:E,item:l,categories:x,isNew:p})=>{const[u,n]=a.useState(w),s=o=>{const{name:k,value:b,files:C}=o.target;n({...u,[k]:C?C[0]:b})},g=async()=>{try{await G(u,E,"image")}catch(o){console.error("Error al enviar el formulario:",o)}};return a.useEffect(()=>{m&&(p?n(w):l&&n({id:l.id||"",news_category_id:l.news_category_id||"",title:l.title||"",link:l.link||"",link_type:l.link_type||"link",image:l.image||null}))},[m,l,p]),e.jsxs(V,{visible:m,onClose:i,size:"lg",children:[e.jsx(z,{children:e.jsx(W,{children:p?"Nuevo":"Editar"})}),e.jsx(H,{children:e.jsx(Y,{children:e.jsxs(O,{children:[e.jsx(y,{md:6,children:e.jsx(T,{type:"text",label:"Título",name:"title",value:u.title,onChange:s,required:!0})}),e.jsx(y,{md:6,children:e.jsxs(P,{"aria-label":"Tipo de Link",name:"link_type",label:"Tipo de Link",value:u.link_type,onChange:s,required:!0,children:[e.jsx("option",{value:"link",children:"General"}),e.jsx("option",{value:"pdf",children:"PDF"})]})}),e.jsx(y,{md:12,children:e.jsx(T,{type:"text",label:"Link",name:"link",value:u.link,onChange:s,required:!0})}),e.jsx(y,{md:6,children:e.jsxs(P,{"aria-label":"Sección",name:"news_category_id",label:"Sección",value:u.news_category_id,onChange:s,required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Selecciona una opción"}),x&&x.map(o=>e.jsx("option",{value:o.id,children:o.title},o.id))]})}),e.jsx(y,{md:6,children:e.jsx(T,{type:"file",label:"Imagen",name:"image",onChange:s})})]})})}),e.jsxs(K,{children:[e.jsx(h,{color:"secondary",onClick:i,children:"Cancelar"}),e.jsx(h,{color:"primary",onClick:g,children:p?"Guardar":"Actualizar"})]})]})};L.propTypes={visible:r.bool.isRequired,onClose:r.func.isRequired,onSave:r.func.isRequired,item:r.shape({id:r.oneOfType([r.number,r.string]),news_category_id:r.oneOfType([r.number,r.string]),title:r.string,link:r.string,link_type:r.string,image:r.oneOfType([r.string,r.object])}).isRequired,categories:r.arrayOf(r.shape({id:r.oneOfType([r.number,r.string]).isRequired,title:r.string.isRequired})).isRequired,isNew:r.bool};const Ae=()=>{const[m,i]=a.useState(null),[E,l]=a.useState([]),[x,p]=a.useState(!0),[u,n]=a.useState(null),[s,g]=a.useState({visible:!1,type:null,item:null}),o=`${d.API_BASE_URL}${d.ENDPOINTS.NOVEDADES.GET}`,k=`${d.API_BASE_URL}${d.ENDPOINTS.CATEGORY_NOVEDADES.GET}`,[b,C]=a.useState([]),[se,R]=a.useState(!0),[ae,v]=a.useState(null),M=a.useCallback(async()=>{try{const t=await f.get(k);t.data.success?C(t.data.data):v(t.data.message)}catch{v("Error al obtener las categorías")}finally{R(!1)}},[]),D=a.useCallback(async()=>{try{const t=await f.get(o);t.data.success?l(t.data.data):n(t.data.message)}catch{n("Error al obtener los datos")}finally{p(!1)}},[o]);a.useEffect(()=>{D(),M()},[]);const q=[{key:"id",label:"ID"},{key:"category.title",label:"Sección"},{key:"title",label:"Título"},{key:"image",label:"Imagen",render:t=>e.jsx(ee,{rounded:!0,src:t.image,style:{maxWidth:"100px"},className:"img-fluid"})},{key:"link",label:"Link",render:t=>e.jsx("a",{href:t.link,target:"_blank",rel:"noreferrer",children:"Ver"})},{key:"link_type",label:"Tipo Link",render:t=>t.link_type==="pdf"?"PDF":t.link_type==="link"?"General":t.link_type},{key:"acciones",header:"Opciones",render:t=>e.jsxs(e.Fragment,{children:[e.jsx(h,{color:"warning",size:"sm",className:"me-2",onClick:()=>S("edit",t),children:e.jsx(I,{icon:te})}),e.jsx(h,{color:"danger",size:"sm",onClick:()=>S("delete",t),children:e.jsx(I,{icon:re})})]})}],$=async t=>{try{const c=!t.id,_=c?`${d.API_BASE_URL}${d.ENDPOINTS.NOVEDADES.CREATE}`:`${d.API_BASE_URL}${d.ENDPOINTS.NOVEDADES.UPDATE(t.id)}`,j=await(c?f.post:f.put)(_,t);j.data.success?(D(),i({text:j.data.message,type:"success"})):(n(j.data.message),i({text:j.data.message,type:"error"}))}catch{n("Error al guardar el registro"),i({text:"Error al guardar el registro",type:"error"})}finally{g({visible:!1,type:null,item:null})}},B=async()=>{if(s.item)try{const t=`${d.API_BASE_URL}${d.ENDPOINTS.NOVEDADES.DELETE(s.item.id)}`,c=await f.delete(t);c.data.success?(l(_=>_.filter(A=>A.id!==s.item.id)),i({text:c.data.message,type:"success"})):(n(c.data.message),i({text:c.data.message,type:"error"}))}catch{n("Error al eliminar el registro"),i({text:"Error al eliminar el registro",type:"error"})}finally{g({visible:!1,type:null,item:null})}},S=(t,c=null)=>{g({visible:!0,type:t,item:c})},N=()=>{g({visible:!1,type:null,item:null})};return a.useEffect(()=>{if(m){const t=setTimeout(()=>i(null),5e3);return()=>clearTimeout(t)}},[m]),x?e.jsx("p",{children:"Cargando..."}):u?e.jsxs("p",{children:["Error: ",u]}):e.jsxs(e.Fragment,{children:[m&&e.jsx(J,{color:m.type==="success"?"success":"danger",dismissible:!0,onClose:()=>i(null),children:m.text}),e.jsx(O,{children:e.jsx(y,{xs:12,children:e.jsxs(Q,{className:"mb-4",children:[e.jsxs(Z,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Novedades"})," ",e.jsx("small",{children:"Listar"})]}),e.jsx(h,{color:"primary",size:"sm",onClick:()=>S("new",{}),children:"Nuevo"})]}),e.jsx(X,{children:e.jsx(F,{itemsPerPage:10,columns:q,data:E,searchKeys:["title","category.title"],defaultSortKey:"id"})})]})})}),["edit","new"].includes(s.type)&&e.jsx(L,{visible:s.visible,onClose:N,onSave:$,item:s.item,categories:b,isNew:s.type==="new"}),s.type==="delete"&&e.jsx(U,{visible:s.visible,onClose:N,onConfirm:B})]})};export{Ae as default};
