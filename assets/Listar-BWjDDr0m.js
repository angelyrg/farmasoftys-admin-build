import{r,j as e,P as a}from"./index-BOhTwHsC.js";import{a as h,e as c}from"./endpoints-CS5nTNlK.js";import{a as x,c as L}from"./index.esm-DVdv_w6Z.js";import{T as U}from"./TablaCoreUI-C0N1yp5E.js";import{M as G}from"./ModalConfirmaciónEliminación-CftZkWG8.js";import{h as z}from"./categoryUtils-C_UIeg_C.js";import{C as V,a as H,b as K,c as W}from"./CModalHeader-Cywm-KxM.js";import{C as Y}from"./CModalTitle-C9QoWCw2.js";import{C as J}from"./CForm-BA2yB9WS.js";import{C as R,a as f}from"./CRow-DiePAMTK.js";import{C as v}from"./CFormInput-BKq-2Q75.js";import{C as O}from"./CFormSelect-BQDtEt72.js";import{C as Q}from"./CAlert-DQxL4qKi.js";import{C as X,a as Z}from"./CCardBody-MXlmbL9P.js";import{C as ee}from"./CCardHeader-DMR-Y4ve.js";import{I as te}from"./DefaultLayout-D6kBYcTj.js";import{c as ae,a as re}from"./cil-trash-prAk5aip.js";import"./react-paginate-CnSu5TAu.js";import"./CTable-DrtmPXdZ.js";import"./cil-chevron-right-DSvcss7_.js";import"./CFormControlWrapper-C92rYEwl.js";import"./CFormControlValidation-Ck9L-Gmv.js";import"./CFormLabel-CpYCFpvI.js";import"./cil-user-Dlmw-Gem.js";import"./softys-8HeVkQ7R.js";const w={id:"",news_category_id:"",title:"",link:"",link_type:"link",image:null},M=({visible:d,onClose:i,onSave:b,item:l,categories:C,isNew:g})=>{const[m,n]=r.useState(w),[s,y]=r.useState(!1),p=u=>{const{name:S,value:D,files:j}=u.target;n({...m,[S]:j?j[0]:D})},k=async()=>{y(!0);try{await z(m,b,"image")}catch(u){console.error("Error al enviar el formulario:",u)}finally{y(!1)}};return r.useEffect(()=>{d&&(g?n(w):l&&n({id:l.id||"",news_category_id:l.news_category_id||"",title:l.title||"",link:l.link||"",link_type:l.link_type||"link",image:l.image||null}))},[d,l,g]),e.jsxs(V,{visible:d,onClose:i,size:"lg",alignment:"center",scrollable:!0,children:[e.jsx(H,{children:e.jsx(Y,{children:g?"Nuevo":"Editar"})}),e.jsx(K,{children:e.jsx(J,{children:e.jsxs(R,{children:[e.jsx(f,{md:6,children:e.jsx(v,{type:"text",label:"Título",name:"title",value:m.title,onChange:p,required:!0})}),e.jsx(f,{md:6,children:e.jsxs(O,{"aria-label":"Tipo de Link",name:"link_type",label:"Tipo de Link",value:m.link_type,onChange:p,required:!0,children:[e.jsx("option",{value:"link",children:"General"}),e.jsx("option",{value:"pdf",children:"PDF"})]})}),e.jsx(f,{md:12,children:e.jsx(v,{type:"text",label:"Link",name:"link",value:m.link,onChange:p,required:!0})}),e.jsx(f,{md:6,children:e.jsxs(O,{"aria-label":"Sección",name:"news_category_id",label:"Sección",value:m.news_category_id,onChange:p,required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Selecciona una opción"}),C&&C.map(u=>e.jsx("option",{value:u.id,children:u.title},u.id))]})}),e.jsx(f,{md:6,children:e.jsx(v,{type:"file",label:"Imagen",name:"image",onChange:p})})]})})}),e.jsxs(W,{children:[e.jsx(x,{color:"secondary",onClick:i,children:"Cancelar"}),e.jsx(x,{color:"primary",onClick:k,disabled:s,children:s?g?"Guardando...":"Actualizando...":g?"Guardar":"Actualizar"})]})]})};M.propTypes={visible:a.bool.isRequired,onClose:a.func.isRequired,onSave:a.func.isRequired,item:a.shape({id:a.oneOfType([a.number,a.string]),news_category_id:a.oneOfType([a.number,a.string]),title:a.string,link:a.string,link_type:a.string,image:a.oneOfType([a.string,a.object])}).isRequired,categories:a.arrayOf(a.shape({id:a.oneOfType([a.number,a.string]).isRequired,title:a.string.isRequired})).isRequired,isNew:a.bool};const Ae=()=>{const[d,i]=r.useState(null),[b,l]=r.useState([]),[C,g]=r.useState(!0),[m,n]=r.useState(null),[s,y]=r.useState({visible:!1,type:null,item:null}),p=`${c.API_BASE_URL}${c.ENDPOINTS.NOVEDADES.GET}`,k=`${c.API_BASE_URL}${c.ENDPOINTS.CATEGORY_NOVEDADES.GET}`,[u,S]=r.useState([]),[D,j]=r.useState(!0),[se,N]=r.useState(null),q=r.useCallback(async()=>{try{const t=await h.get(k);t.data.success?S(t.data.data):N(t.data.message)}catch{N("Error al obtener las categorías")}finally{j(!1)}},[]),A=r.useCallback(async()=>{try{const t=await h.get(p);t.data.success?l(t.data.data):n(t.data.message)}catch{n("Error al obtener los datos")}finally{g(!1)}},[p]);r.useEffect(()=>{A(),q()},[]);const $=[{key:"id",label:"ID"},{key:"category.title",label:"Sección"},{key:"title",label:"Título"},{key:"image",label:"Imagen",render:t=>e.jsx(te,{rounded:!0,src:t.image,style:{maxWidth:"100px"},className:"img-fluid"})},{key:"link",label:"Link",render:t=>e.jsx("a",{href:t.link,target:"_blank",rel:"noreferrer",children:"Ver"})},{key:"link_type",label:"Tipo Link",render:t=>t.link_type==="pdf"?"PDF":t.link_type==="link"?"General":t.link_type},{key:"acciones",label:"Opciones",render:t=>e.jsxs(e.Fragment,{children:[e.jsx(x,{color:"warning",size:"sm",className:"me-2",onClick:()=>_("edit",t),children:e.jsx(L,{icon:ae})}),e.jsx(x,{color:"danger",size:"sm",onClick:()=>_("delete",t),children:e.jsx(L,{icon:re})})]})}],B=async t=>{try{const o=!t.id,T=o?`${c.API_BASE_URL}${c.ENDPOINTS.NOVEDADES.CREATE}`:`${c.API_BASE_URL}${c.ENDPOINTS.NOVEDADES.UPDATE(t.id)}`,E=await(o?h.post:h.put)(T,t);E.data.success?(A(),i({text:E.data.message,type:"success"})):(n(E.data.message),i({text:E.data.message,type:"error"}))}catch{n("Error al guardar el registro"),i({text:"Error al guardar el registro",type:"error"})}finally{y({visible:!1,type:null,item:null})}},F=async()=>{if(s.item)try{const t=`${c.API_BASE_URL}${c.ENDPOINTS.NOVEDADES.DELETE(s.item.id)}`,o=await h.delete(t);o.data.success?(l(T=>T.filter(P=>P.id!==s.item.id)),i({text:o.data.message,type:"success"})):(n(o.data.message),i({text:o.data.message,type:"error"}))}catch{n("Error al eliminar el registro"),i({text:"Error al eliminar el registro",type:"error"})}finally{y({visible:!1,type:null,item:null})}},_=(t,o=null)=>{y({visible:!0,type:t,item:o})},I=()=>{y({visible:!1,type:null,item:null})};return r.useEffect(()=>{if(d){const t=setTimeout(()=>i(null),5e3);return()=>clearTimeout(t)}},[d]),C?e.jsx("p",{children:"Cargando..."}):m?e.jsxs("p",{children:["Error: ",m]}):e.jsxs(e.Fragment,{children:[d&&e.jsx(Q,{color:d.type==="success"?"success":"danger",dismissible:!0,onClose:()=>i(null),children:d.text}),e.jsx(R,{children:e.jsx(f,{xs:12,children:e.jsxs(X,{className:"mb-4",children:[e.jsxs(ee,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Novedades"})," ",e.jsx("small",{children:"Listar"})]}),e.jsx(x,{color:"primary",size:"sm",onClick:()=>_("new",{}),children:"Nuevo"})]}),e.jsx(Z,{children:e.jsx(U,{itemsPerPage:10,columns:$,data:b,searchKeys:["title","category.title"],defaultSortKey:"id"})})]})})}),["edit","new"].includes(s.type)&&e.jsx(M,{visible:s.visible,onClose:I,onSave:B,item:s.item,categories:u,isNew:s.type==="new"}),s.type==="delete"&&e.jsx(G,{visible:s.visible,onClose:I,onConfirm:F})]})};export{Ae as default};
