import{r,j as e}from"./index-D_GdLVNr.js";import{a as j,e as i}from"./endpoints-C5U9E4-a.js";import{a as b,c as P}from"./index.esm-DRk_pvbg.js";import{M as N}from"./ModalConfirmaciónEliminación-C_9p0V_F.js";import{T as R}from"./TablaCoreUI-Duc8eLwG.js";import{h as O}from"./categoryUtils-BrWzkkvK.js";import{C as $,a as w,b as p,c as B,d as F}from"./CModalTitle-ChiwV2rl.js";import{C as q}from"./CForm-2yPFF1oe.js";import{C as I,a as m}from"./CRow-Cvk70ulk.js";import{C as G}from"./CFormSelect-CQ02tu3t.js";import{C as g}from"./CFormInput-C5SD1SPI.js";import{C as z,a as K}from"./CCardBody-CBjSyW9A.js";import{C as H}from"./CCardHeader-BuFN-RW-.js";import{I as Y}from"./DefaultLayout-BL0ILRaz.js";import{c as J,a as Q}from"./cil-trash-prAk5aip.js";import"./react-paginate-D-XeyCIx.js";import"./CTable-DKOopARd.js";import"./cil-chevron-right-DSvcss7_.js";import"./CFormControlWrapper-DEzgwmCW.js";import"./CFormControlValidation-C8HRK1ME.js";import"./CFormLabel-C-XoEc7E.js";import"./cil-user-Dlmw-Gem.js";import"./softys-8HeVkQ7R.js";const V=({visible:C,onClose:h,onSave:x,product:a,categoryItems:y})=>{const[t,n]=r.useState({id:(a==null?void 0:a.id)||"",category_id:(a==null?void 0:a.category_id)||"",sector_general:(a==null?void 0:a.sector_general)||"",sector_detallado:(a==null?void 0:a.sector_detallado)||"",marca_detalle:(a==null?void 0:a.marca_detalle)||"",comision:(a==null?void 0:a.comision)||"",imagen_sku:null}),l=o=>{const{name:S,value:E,files:f}=o.target;n({...t,[S]:f?f[0]:E})},d=async()=>{try{await O(t,x,"imagen_sku")}catch(o){console.error("Error al enviar el formulario:",o)}};return r.useEffect(()=>{n({id:(a==null?void 0:a.id)||"",category_id:(a==null?void 0:a.category_id)||"",sector_general:(a==null?void 0:a.sector_general)||"",sector_detallado:(a==null?void 0:a.sector_detallado)||"",marca_detalle:(a==null?void 0:a.marca_detalle)||"",comision:(a==null?void 0:a.comision)||"",imagen_sku:(a==null?void 0:a.imagen_sku)||null})},[a]),e.jsxs($,{visible:C,onClose:h,size:"lg",children:[e.jsx(w,{children:e.jsx(p,{children:"Editar Categoría"})}),e.jsx(B,{children:e.jsx(q,{children:e.jsxs(I,{children:[e.jsx(m,{md:6,children:e.jsxs(G,{"aria-label":"Categoría",name:"category_id",label:"Categoría",value:t.category_id,onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Selecciona una categoría"}),y&&y.map(o=>e.jsx("option",{value:o.id,children:o.description},o.id))]})}),e.jsx(m,{md:6,children:e.jsx(g,{type:"text",label:"Sector general",name:"sector_general",value:t.sector_general,onChange:l,required:!0})}),e.jsx(m,{md:6,children:e.jsx(g,{type:"text",label:"Sector detallado",name:"sector_detallado",value:t.sector_detallado,onChange:l,required:!0})}),e.jsx(m,{md:6,children:e.jsx(g,{type:"text",label:"Marca detallado",name:"marca_detalle",value:t.marca_detalle,onChange:l,required:!0})}),e.jsx(m,{md:6,children:e.jsx(g,{type:"number",step:.01,label:"Comisión",name:"comision",value:t.comision,onChange:l,required:!0})}),e.jsx(m,{md:6,children:e.jsx(g,{type:"file",label:"Imagen",name:"imagen_sku",onChange:l})})]})})}),e.jsxs(F,{children:[e.jsx(b,{color:"secondary",onClick:h,children:"Cancelar"}),e.jsx(b,{color:"primary",onClick:d,children:"Guardar"})]})]})},be=()=>{const C=`${i.API_BASE_URL}${i.ENDPOINTS.PRODUCTS.GET}`,[h,x]=r.useState([]),[a,y]=r.useState(!0),[t,n]=r.useState(null),[l,d]=r.useState({visible:!1,type:null,product:null}),o=`${i.API_BASE_URL}${i.ENDPOINTS.CATEGORY.GET}`,[S,E]=r.useState(!0),[f,D]=r.useState([]),T=r.useCallback(async()=>{try{const s=await j.get(o);s.data.success?D(s.data.data):setCategoryError(s.data.message)}catch{setCategoryError("Error al obtener las categorías")}finally{E(!1)}},[]),u=r.useCallback(async()=>{try{const s=await j.get(C);s.data.success?x(s.data.data):n(s.data.message)}catch{n("Error al obtener los datos")}finally{y(!1)}},[C]);r.useEffect(()=>{u(),T()},[]);const M=[{key:"id",label:"ID"},{key:"sector_general",label:"Sector General"},{key:"sector_detallado",label:"Sector Detallado"},{key:"marca_detalle",label:"Marca Detallado"},{key:"imagen_sku",label:"Imagen",render:s=>e.jsx(Y,{rounded:!0,thumbnail:!0,src:s.imagen_sku,width:50,height:"auto"})},{key:"comision",label:"Comisión",render:s=>`S/ ${s.comision}`},{key:"acciones",label:"Opciones",render:s=>e.jsxs(e.Fragment,{children:[e.jsx(b,{color:"warning",size:"sm",className:"me-2",onClick:()=>k("edit",s),children:e.jsx(P,{icon:J})}),e.jsx(b,{color:"danger",size:"sm",onClick:()=>k("delete",s),children:e.jsx(P,{icon:Q})})]})}],U=async()=>{if(console.log(l),l.product)try{const s=`${i.API_BASE_URL}${i.ENDPOINTS.PRODUCTS.DELETE(l.product.id)}`,c=await j.delete(s);c.data.success?x(_=>_.filter(L=>L.id!==l.product.id)):n(c.data.message)}catch{n("Error al eliminar el producto")}finally{d({visible:!1,type:null,product:null})}},A=async s=>{try{const c=`${i.API_BASE_URL}${i.ENDPOINTS.PRODUCTS.UPDATE(s.id)}`,_=await j.put(c,s);_.data.success?u():n(_.data.message)}catch{n("Error al actualizar el producto")}finally{d({visible:!1,type:null,product:null})}},k=(s,c=null)=>{d({visible:!0,type:s,product:c})},v=()=>{d({visible:!1,type:null,product:null})};return a?e.jsx("p",{children:"Cargando..."}):t?e.jsxs("p",{children:["Error: ",t]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{children:e.jsx(m,{xs:12,children:e.jsxs(z,{className:"mb-4",children:[e.jsxs(H,{children:[e.jsx("strong",{children:"Productos(SKU)"})," ",e.jsx("small",{children:"Listar"})]}),e.jsx(K,{children:e.jsx(R,{itemsPerPage:10,columns:M,data:h,searchKeys:["sector_general","sector_detallado","marca_detalle"],defaultSortKey:"id"})})]})})}),l.type==="delete"&&e.jsx(N,{visible:l.visible,onClose:v,onConfirm:U}),l.type==="edit"&&e.jsx(V,{visible:l.visible,onClose:v,onSave:A,product:l.product,categoryItems:f})]})};export{be as default};
