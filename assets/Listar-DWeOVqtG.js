import{r as i,j as e,P as a}from"./index-BOhTwHsC.js";import{a as E,e as u}from"./endpoints-CS5nTNlK.js";import{a as C,c as A}from"./index.esm-DVdv_w6Z.js";import{T as L}from"./TablaCoreUI-C0N1yp5E.js";import{M as O}from"./ModalConfirmaciónEliminación-CftZkWG8.js";import{h as M}from"./categoryUtils-C_UIeg_C.js";import{C as w,a as U,b as $,c as q}from"./CModalHeader-Cywm-KxM.js";import{C as B}from"./CModalTitle-C9QoWCw2.js";import{C as F}from"./CForm-BA2yB9WS.js";import{C as P,a as m}from"./CRow-DiePAMTK.js";import{C as p}from"./CFormInput-BKq-2Q75.js";import{C as z}from"./CAlert-DQxL4qKi.js";import{C as G,a as H}from"./CCardBody-MXlmbL9P.js";import{C as K}from"./CCardHeader-DMR-Y4ve.js";import{c as Z,a as J}from"./cil-trash-prAk5aip.js";import"./react-paginate-CnSu5TAu.js";import"./CTable-DrtmPXdZ.js";import"./cil-chevron-right-DSvcss7_.js";import"./DefaultLayout-D6kBYcTj.js";import"./cil-user-Dlmw-Gem.js";import"./softys-8HeVkQ7R.js";import"./CFormControlWrapper-C92rYEwl.js";import"./CFormControlValidation-Ck9L-Gmv.js";import"./CFormLabel-CpYCFpvI.js";const N={id:"",name:"",ruc:"",address:"",latitude:"",longitude:"",phone:"",max_radius:"",tienda_img:null},I=({visible:h,onClose:g,onSave:S,item:r,isNew:l})=>{const[t,f]=i.useState(N),[c,o]=i.useState(!1),n=x=>{const{name:T,value:v,files:b}=x.target;f({...t,[T]:b?b[0]:v})},y=async()=>{o(!0);try{await M(t,S,"tienda_img")}catch(x){console.error("Error al enviar el formulario:",x)}finally{o(!1)}};return i.useEffect(()=>{h&&(l?f(N):r&&f({id:r.id||"",name:r.name||"",ruc:r.ruc||"",address:r.address||"",latitude:r.latitude||"",longitude:r.longitude||"",phone:r.phone||"",max_radius:r.max_radius||"",tienda_img:r.tienda_img||null}))},[h,r,l]),e.jsxs(w,{visible:h,onClose:g,backdrop:"static",keyboard:!1,size:"lg",alignment:"center",scrollable:!0,children:[e.jsx(U,{children:e.jsx(B,{children:l?"Nuevo":"Editar"})}),e.jsx($,{children:e.jsx(F,{children:e.jsxs(P,{children:[e.jsx(m,{md:6,children:e.jsx(p,{type:"text",label:"Nombre",name:"name",value:t.name,onChange:n,placeholder:"Nombre de la tienda",autoComplete:"off",required:!0})}),e.jsx(m,{md:6,children:e.jsx(p,{type:"text",label:"RUC",name:"ruc",autoComplete:"off",value:t.ruc,onChange:n,maxLength:20,required:!0})}),e.jsx(m,{md:6,children:e.jsx(p,{type:"text",label:"Dirección",name:"address",autoComplete:"off",value:t.address,onChange:n,required:!0})}),e.jsx(m,{md:6,children:e.jsx(p,{type:"text",label:"Teléfono",name:"phone",autoComplete:"off",value:t.phone,onChange:n})}),e.jsx(m,{md:2,sm:6,children:e.jsx(p,{type:"number",label:"Latitud",name:"latitude",autoComplete:"off",value:t.latitude,onChange:n,placeholder:"-12.04318",step:"any",min:"-90",max:"90"})}),e.jsx(m,{md:2,sm:6,children:e.jsx(p,{type:"number",label:"Longitud",name:"longitude",autoComplete:"off",value:t.longitude,onChange:n,placeholder:"-77.02824",step:"any",min:"-180",max:"180"})}),e.jsx(m,{md:2,sm:6,children:e.jsx(p,{type:"number",label:"Radio máximo",name:"max_radius",autoComplete:"off",value:t.max_radius,onChange:n,step:"any",min:"0",max:"180"})}),e.jsx(m,{md:6,children:e.jsx(p,{type:"file",label:"Imagen",name:"tienda_img",onChange:n,accept:"image/*"})})]})})}),e.jsxs(q,{children:[e.jsx(C,{color:"secondary",onClick:g,children:"Cancelar"}),e.jsx(C,{color:"primary",onClick:y,disabled:c,children:c?l?"Guardando...":"Actualizando...":l?"Guardar":"Actualizar"})]})]})};I.propTypes={visible:a.bool.isRequired,onClose:a.func.isRequired,onSave:a.func.isRequired,item:a.shape({id:a.oneOfType([a.number,a.string]),name:a.string,ruc:a.string,address:a.string,latitude:a.oneOfType([a.number,a.string]),longitude:a.oneOfType([a.number,a.string]),phone:a.string,max_radius:a.oneOfType([a.number,a.string]),tienda_img:a.oneOfType([a.string,a.object])}).isRequired,isNew:a.bool};const ye=()=>{const[h,g]=i.useState([]),[S,r]=i.useState(!0),[l,t]=i.useState(null),[f,c]=i.useState(null),[o,n]=i.useState({visible:!1,type:null,item:null}),y=`${u.API_BASE_URL}${u.ENDPOINTS.STORES.GET}`,x=i.useCallback(async()=>{try{const s=await E.get(y);s.data.success?g(s.data.data):c(s.data.message)}catch{c("Error al obtener los datos")}finally{r(!1)}},[y]);i.useEffect(()=>{x()},[]);const T=[{key:"id",label:"ID"},{key:"ruc",label:"RUC"},{key:"name",label:"Nombre"},{key:"address",label:"Dirección"},{key:"phone",label:"Celular"},{key:"coords",label:"Coordenadas",render:s=>e.jsxs("span",{children:[s.latitude,", ",s.longitude]})},{key:"max_radius",label:"Rango"},{key:"fecha",label:"Fecha de creación",render:s=>new Date(s.createdAt).toLocaleString("es-PE",{timeZone:"America/Lima"})},{key:"acciones",label:"Opciones",render:s=>e.jsxs(e.Fragment,{children:[e.jsx(C,{color:"warning",size:"sm",className:"me-2",onClick:()=>_("edit",s),children:e.jsx(A,{icon:Z})}),e.jsx(C,{color:"danger",size:"sm",onClick:()=>_("delete",s),children:e.jsx(A,{icon:J})})]})}],v=async s=>{try{const d=!s.id,R=d?`${u.API_BASE_URL}${u.ENDPOINTS.STORES.CREATE}`:`${u.API_BASE_URL}${u.ENDPOINTS.STORES.UPDATE(s.id)}`,j=await(d?E.post:E.put)(R,s);j.data.success?(x(),t({text:j.data.message,type:"success"})):(c(j.data.message),t({text:j.data.message,type:"error"}))}catch{c("Error al guardar el registro"),t({text:"Error al guardar el registro",type:"error"})}finally{n({visible:!1,type:null,item:null})}},b=async()=>{if(o.item)try{const s=`${u.API_BASE_URL}${u.ENDPOINTS.STORES.DELETE(o.item.id)}`,d=await E.delete(s);d.data.success?(g(R=>R.filter(D=>D.id!==o.item.id)),t({text:d.data.message,type:"success"})):(c(d.data.message),t({text:d.data.message,type:"error"}))}catch{c("Error al eliminar el registro"),t({text:"Error al eliminar el registro",type:"error"})}finally{n({visible:!1,type:null,item:null})}},_=(s,d=null)=>{n({visible:!0,type:s,item:d})},k=()=>{n({visible:!1,type:null,item:null})};return i.useEffect(()=>{if(l){const s=setTimeout(()=>t(null),5e3);return()=>clearTimeout(s)}},[l]),S?e.jsx("p",{children:"Cargando..."}):f?e.jsxs("p",{children:["Error: ",f]}):e.jsxs(e.Fragment,{children:[l&&e.jsx(z,{color:l.type==="success"?"success":"danger",dismissible:!0,onClose:()=>t(null),children:l.text}),e.jsx(P,{children:e.jsx(m,{xs:12,children:e.jsxs(G,{className:"mb-4",children:[e.jsxs(K,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Tiendas"})," ",e.jsx("small",{children:"Listar"})]}),e.jsx(C,{color:"primary",size:"sm",onClick:()=>_("new",{}),children:"Nuevo"})]}),e.jsx(H,{children:e.jsx(L,{itemsPerPage:15,columns:T,data:h,searchKeys:["ruc","name","address","phone"],defaultSortKey:"id"})})]})})}),["edit","new"].includes(o.type)&&e.jsx(I,{visible:o.visible,onClose:k,onSave:v,item:o.item,isNew:o.type==="new"}),o.type==="delete"&&e.jsx(O,{visible:o.visible,onClose:k,onConfirm:b})]})};export{ye as default};
